<?php
require_once "config.php";
$id = 0;
$name = 0;
$description = 0;
$date = 0;

if(array_key_exists('id', $_POST)) $name = $_POST['id'];
if(array_key_exists('name', $_POST) && empty($_POST['name'])) $name = $_POST['name'];
if(array_key_exists('description', $_POST) && empty($_POST['description'])) $description = $_POST['description'];
if(array_key_exists('date', $_POST) && empty($_POST['date'])) $date = $_POST['date'];
//Create
if (isset($_POST['submit'])) {
    $sql = ("INSERT INTO `comments`(`id`, `name`, `description`, `date`) VALUES(?,?,?,?)");
    $query = $pdo->prepare($sql);
    $query->execute([$id, $name, $description, $date]);

}

//Read
$sql = $pdo->prepare("SELECT * FROM `comments`");
$sql->execute();
$result = $sql->fetchAll();

// Update
$edit_name = @$_POST['edit_name'];
$edit_description = @$_POST['edit_description'];
$get_id = @$_GET['id'];
if (isset($_POST['edit-submit'])) {
    if($edit_name && $edit_description){
        $pdo->prepare("SELECT COUNT(*) FROM comments WHERE id = ?");
        $checkSql->execute([$get_id]);
        if ($checkSql->fetchColumn() > 0) {
            $sqll = ("UPDATE `comments` SET `name`=?, `description`=? WHERE id=?");
            $querys = $pdo->prepare($sqll);
            $querys->execute([$edit_name, $edit_description, $get_id]);
            header('Location: '. $_SERVER['HTTP_REFERER']);
        }
    }

}


//Delete
if (isset($_POST['delete_submit'])) {
    $sql = ("DELETE FROM `comments` WHERE id=?");
    $query = $pdo->prepare($sql);
    $query->execute([$get_id]);
    //header('Location: '. $_SERVER['HTTP_REFERER']);
}

function print_arr($data): void{
        echo "<pre>".print_r($data,1)."</pre>";
}


